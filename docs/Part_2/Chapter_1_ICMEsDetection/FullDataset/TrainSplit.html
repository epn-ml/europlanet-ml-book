
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Notebook for automatic detection of ICMEs &#8212; The Europlanet Machine Learning Book</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet">
  <link href="../../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../_static/Europlanet_Machine_Learning_Logo_Standard.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">The Europlanet Machine Learning Book</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Dieses Buch durchsuchen ..." aria-label="Dieses Buch durchsuchen ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../Foreword.html">
   The Europlanet Machine Learning Book
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  1. Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../Chapter_1_Introduction/Content.html">
   1. Introduction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  2. Basic Tutorials
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../Part_1/Introduction.html">
   1. Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../Part_1/Chapter_1_SupervisedClassification/Tutorial_SupervisedClassification.html">
   2. Supervised classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../Part_1/Chapter_2_SupervisedRegression/Tutorial_SupervisedRegression.html">
   3. Supervised regression
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  3. Automatic Detection of ICMEs
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Introduction.html">
   1. Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ScienceBackground.html">
   2. Science Background - Interplanetary Coronal Mass Ejections
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Tutorial-ICMEs/MachineLearningPipeline.html">
   3. Machine Learning Pipeline for Automated Detection of ICMEs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Summary.html">
   4. Summary and Discussion
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  References
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../References/bibliography.html">
   1. References
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Navigation umschalten" aria-controls="site-navigation"
                title="Navigation umschalten" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Laden Sie diese Seite herunter"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/Part_2/Chapter_1_ICMEsDetection/FullDataset/TrainSplit.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Quelldatei herunterladen" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="In PDF drucken"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Vollbildmodus"
        title="Vollbildmodus"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/Part_2/Chapter_1_ICMEsDetection/FullDataset/TrainSplit.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Starten Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Notebook for automatic detection of ICMEs</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="notebook-for-automatic-detection-of-icmes">
<h1>Notebook for automatic detection of ICMEs<a class="headerlink" href="#notebook-for-automatic-detection-of-icmes" title="Permalink to this headline">Â¶</a></h1>
<p>This notebook documents the code used for the automatic detection of ICMEs. It is running on Python 3.8.5 with dependencies listed in the requirements.txt file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#only use if GPU available</span>

<span class="c1">#Set devices_id</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CUDA_DEVICE_ORDER&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;PCI_BUS_ID&quot;</span> 
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CUDA_VISIBLE_DEVICES&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="n">tf</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">is_gpu_available</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="n">x3</span><span class="o">/</span><span class="mi">2</span><span class="n">bzh843n0tv469w6l6sd8sq00000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_74758</span><span class="o">/</span><span class="mf">790403423.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CUDA_VISIBLE_DEVICES&quot;</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> 
<span class="ne">----&gt; </span><span class="mi">8</span> <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">tf</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">is_gpu_available</span><span class="p">()</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;tensorflow&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Don&#39;t print warnings</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pds</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.metrics</span> <span class="kn">import</span> <span class="n">Precision</span><span class="p">,</span> <span class="n">Recall</span><span class="p">,</span> <span class="n">MeanIoU</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span><span class="p">,</span> <span class="n">Nadam</span><span class="p">,</span> <span class="n">SGD</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span><span class="p">,</span> <span class="n">ModelCheckpoint</span><span class="p">,</span> <span class="n">ReduceLROnPlateau</span><span class="p">,</span> <span class="n">CSVLogger</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">load_model</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.utils</span> <span class="kn">import</span> <span class="n">CustomObjectScope</span>

<span class="kn">from</span> <span class="nn">unetgen</span> <span class="kn">import</span> <span class="n">UnetGen</span>
<span class="kn">from</span> <span class="nn">m_resunet</span> <span class="kn">import</span> <span class="n">ResUnetPlusPlus</span>
<span class="kn">from</span> <span class="nn">metrics</span> <span class="kn">import</span> <span class="n">dice_coef</span><span class="p">,</span> <span class="n">dice_loss</span><span class="p">,</span> <span class="n">true_skill_score</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">loss_functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">features</span>
<span class="kn">import</span> <span class="nn">preProcess</span>

<span class="kn">import</span> <span class="nn">pyarrow.parquet</span> <span class="k">as</span> <span class="nn">pq</span>
<span class="kn">import</span> <span class="nn">event</span> <span class="k">as</span> <span class="nn">evt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load data and event list</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pq</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s1">&#39;datasetWithSpectro.parquet&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>

<span class="n">evtList</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;listOfICMEs.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#preprocess on the data set</span>
<span class="n">features</span><span class="o">.</span><span class="n">computeBeta</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">features</span><span class="o">.</span><span class="n">computePdyn</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">features</span><span class="o">.</span><span class="n">computeRmsBob</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="n">startTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1997</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">endTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2016</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">&lt;</span><span class="n">endTime</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">&gt;</span><span class="n">startTime</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;10T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>


<span class="c1"># delete empty events</span>

<span class="n">evtList</span> <span class="o">=</span> <span class="n">preProcess</span><span class="o">.</span><span class="n">clearempties</span><span class="p">(</span><span class="n">evtList</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">postProcess</span>
<span class="n">nguyen</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;listOfICMEs.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">chinchilla</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">read_chinchilla</span><span class="p">()</span>
<span class="n">chi</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">read_chi</span><span class="p">()</span>
<span class="n">helcats</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">get_catevents</span><span class="p">()</span>

<span class="n">dicoflists</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Nieves-Chinchilla&#39;</span><span class="p">:</span> <span class="n">chinchilla</span><span class="p">,</span> <span class="s1">&#39;Nguyen&#39;</span><span class="p">:</span><span class="n">nguyen</span><span class="p">,</span> <span class="s1">&#39;Chi&#39;</span><span class="p">:</span><span class="n">chi</span><span class="p">,</span><span class="s1">&#39;HELIO4CAST&#39;</span><span class="p">:</span><span class="n">helcats</span><span class="p">}</span>
<span class="n">postProcess</span><span class="o">.</span><span class="n">compare_lists</span><span class="p">(</span><span class="n">dicoflists</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Nieves-Chinchilla    313
Nguyen               640
Chi                  427
HELIO4CAST           144
dtype: object
     Nieves-Chinchilla Nguyen Chi HELIO4CAST
1998                29     52  34        NaN
1999                18     37  29        NaN
2000                31     56  43        NaN
2001                24     68  49        NaN
2002                21     46  31        NaN
2003                10     28  13        NaN
2004                13     27  16        NaN
2005                16     39  28        NaN
2006                13     17  10        NaN
2007                 7     11   5          7
2008                 5      9   6          5
2009                15     20  12         15
2010                14     37  16         15
2011                19     38  22         22
2012                29     48  37         30
2013                21     37  21         21
2014                15     33  23         15
2015                13     37  32         14
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
<img alt="../../../_images/TrainSplit_5_2.png" src="../../../_images/TrainSplit_5_2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">truelabel</span> <span class="o">=</span> <span class="n">pds</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">preProcess</span><span class="o">.</span><span class="n">get_truelabel</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">evtList</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scale</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scale</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">data_scaled</span> <span class="o">=</span> <span class="n">pds</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">scale</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># run for all 6 available splits to achieve overall result</span>

<span class="n">split</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">test</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">train</span> <span class="o">=</span> <span class="n">preProcess</span><span class="o">.</span><span class="n">getbalancedsplit</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="s1">&#39;nguyen&#39;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">Y_val</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span> <span class="o">=</span> <span class="n">preProcess</span><span class="o">.</span><span class="n">getdatas</span><span class="p">(</span><span class="n">train</span><span class="p">,</span><span class="n">test</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">data_scaled</span><span class="p">,</span><span class="n">truelabel</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">preProcess</span><span class="o">.</span><span class="n">printpercentage</span><span class="p">(</span><span class="n">Y_test</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">preProcess</span><span class="o">.</span><span class="n">printpercentage</span><span class="p">(</span><span class="n">Y_train</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">preProcess</span><span class="o">.</span><span class="n">printpercentage</span><span class="p">(</span><span class="n">Y_val</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>label    0.102693
dtype: float64
label    0.104657
dtype: float64
label    0.10432
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Semantic_loss_functions</span><span class="p">()</span>

<span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;Results/&quot;</span>
<span class="n">model_path</span> <span class="o">=</span> <span class="s2">&quot;Results/resunetplusplus_split&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">split</span><span class="p">)</span>

<span class="c1">## Parameters</span>
<span class="n">C</span> <span class="o">=</span> <span class="mi">33</span>
<span class="n">t</span> <span class="o">=</span> <span class="mi">1024</span>
<span class="n">image_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">C</span><span class="p">)</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">initial_learning_rate</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">epochs</span> <span class="o">=</span><span class="mi">500</span>

<span class="c1">## Generator</span>
<span class="n">train_gen</span> <span class="o">=</span> <span class="n">UnetGen</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Y_train</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">stride</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>  <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span><span class="n">expanddims</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">valid_gen</span> <span class="o">=</span> <span class="n">UnetGen</span><span class="p">(</span><span class="n">X_val</span><span class="p">,</span> <span class="n">Y_val</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">stride</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span><span class="n">expanddims</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>semantic loss functions initialized
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cycliclr</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">expclr</span> <span class="o">=</span> <span class="n">CyclicLR</span><span class="p">(</span><span class="n">base_lr</span><span class="o">=</span><span class="mf">0.00001</span><span class="p">,</span> <span class="n">max_lr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## ResUnet++</span>
<span class="n">arch</span> <span class="o">=</span> <span class="n">ResUnetPlusPlus</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="n">image_size</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">build_medium</span><span class="p">()</span>

<span class="n">optimizer</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">()</span> 

<span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="n">Recall</span><span class="p">(),</span> <span class="n">Precision</span><span class="p">(),</span> <span class="n">dice_coef</span><span class="p">,</span><span class="n">true_skill_score</span><span class="p">,</span> <span class="n">MeanIoU</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="mi">2</span><span class="p">)]</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">dice_loss</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">)</span> 

<span class="n">csv_logger</span> <span class="o">=</span> <span class="n">CSVLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">unet_</span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">checkpoint</span> <span class="o">=</span> <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">save_best_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">callbacks</span> <span class="o">=</span> <span class="p">[</span><span class="n">csv_logger</span><span class="p">,</span> <span class="n">checkpoint</span><span class="p">,</span> <span class="n">early_stopping</span><span class="p">,</span> <span class="n">expclr</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-25 11:12:46.619727: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 15405 MB memory:  -&gt; device: 0, name: Tesla P100-PCIE-16GB, pci bus id: 0000:01:00.0, compute capability: 6.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model: &quot;ResUNetPlusPlusmedium&quot;
__________________________________________________________________________________________________
Layer (type)                    Output Shape         Param #     Connected to                     
==================================================================================================
input_1 (InputLayer)            [(None, 1024, 1, 33) 0                                            
__________________________________________________________________________________________________
conv2d (Conv2D)                 (None, 1024, 1, 64)  6400        input_1[0][0]                    
__________________________________________________________________________________________________
batch_normalization (BatchNorma (None, 1024, 1, 64)  256         conv2d[0][0]                     
__________________________________________________________________________________________________
activation (Activation)         (None, 1024, 1, 64)  0           batch_normalization[0][0]        
__________________________________________________________________________________________________
conv2d_2 (Conv2D)               (None, 1024, 1, 64)  2176        input_1[0][0]                    
__________________________________________________________________________________________________
conv2d_1 (Conv2D)               (None, 1024, 1, 64)  12352       activation[0][0]                 
__________________________________________________________________________________________________
batch_normalization_1 (BatchNor (None, 1024, 1, 64)  256         conv2d_2[0][0]                   
__________________________________________________________________________________________________
add (Add)                       (None, 1024, 1, 64)  0           conv2d_1[0][0]                   
                                                                 batch_normalization_1[0][0]      
__________________________________________________________________________________________________
global_average_pooling2d (Globa (None, 64)           0           add[0][0]                        
__________________________________________________________________________________________________
reshape (Reshape)               (None, 1, 1, 64)     0           global_average_pooling2d[0][0]   
__________________________________________________________________________________________________
dense (Dense)                   (None, 1, 1, 8)      512         reshape[0][0]                    
__________________________________________________________________________________________________
dense_1 (Dense)                 (None, 1, 1, 64)     512         dense[0][0]                      
__________________________________________________________________________________________________
multiply (Multiply)             (None, 1024, 1, 64)  0           add[0][0]                        
                                                                 dense_1[0][0]                    
__________________________________________________________________________________________________
batch_normalization_2 (BatchNor (None, 1024, 1, 64)  256         multiply[0][0]                   
__________________________________________________________________________________________________
activation_1 (Activation)       (None, 1024, 1, 64)  0           batch_normalization_2[0][0]      
__________________________________________________________________________________________________
conv2d_3 (Conv2D)               (None, 256, 1, 128)  24704       activation_1[0][0]               
__________________________________________________________________________________________________
batch_normalization_3 (BatchNor (None, 256, 1, 128)  512         conv2d_3[0][0]                   
__________________________________________________________________________________________________
activation_2 (Activation)       (None, 256, 1, 128)  0           batch_normalization_3[0][0]      
__________________________________________________________________________________________________
conv2d_5 (Conv2D)               (None, 256, 1, 128)  8320        multiply[0][0]                   
__________________________________________________________________________________________________
conv2d_4 (Conv2D)               (None, 256, 1, 128)  49280       activation_2[0][0]               
__________________________________________________________________________________________________
batch_normalization_4 (BatchNor (None, 256, 1, 128)  512         conv2d_5[0][0]                   
__________________________________________________________________________________________________
add_1 (Add)                     (None, 256, 1, 128)  0           conv2d_4[0][0]                   
                                                                 batch_normalization_4[0][0]      
__________________________________________________________________________________________________
global_average_pooling2d_1 (Glo (None, 128)          0           add_1[0][0]                      
__________________________________________________________________________________________________
reshape_1 (Reshape)             (None, 1, 1, 128)    0           global_average_pooling2d_1[0][0] 
__________________________________________________________________________________________________
dense_2 (Dense)                 (None, 1, 1, 16)     2048        reshape_1[0][0]                  
__________________________________________________________________________________________________
dense_3 (Dense)                 (None, 1, 1, 128)    2048        dense_2[0][0]                    
__________________________________________________________________________________________________
multiply_1 (Multiply)           (None, 256, 1, 128)  0           add_1[0][0]                      
                                                                 dense_3[0][0]                    
__________________________________________________________________________________________________
batch_normalization_5 (BatchNor (None, 256, 1, 128)  512         multiply_1[0][0]                 
__________________________________________________________________________________________________
activation_3 (Activation)       (None, 256, 1, 128)  0           batch_normalization_5[0][0]      
__________________________________________________________________________________________________
conv2d_6 (Conv2D)               (None, 64, 1, 256)   98560       activation_3[0][0]               
__________________________________________________________________________________________________
batch_normalization_6 (BatchNor (None, 64, 1, 256)   1024        conv2d_6[0][0]                   
__________________________________________________________________________________________________
activation_4 (Activation)       (None, 64, 1, 256)   0           batch_normalization_6[0][0]      
__________________________________________________________________________________________________
conv2d_8 (Conv2D)               (None, 64, 1, 256)   33024       multiply_1[0][0]                 
__________________________________________________________________________________________________
conv2d_7 (Conv2D)               (None, 64, 1, 256)   196864      activation_4[0][0]               
__________________________________________________________________________________________________
batch_normalization_7 (BatchNor (None, 64, 1, 256)   1024        conv2d_8[0][0]                   
__________________________________________________________________________________________________
add_2 (Add)                     (None, 64, 1, 256)   0           conv2d_7[0][0]                   
                                                                 batch_normalization_7[0][0]      
__________________________________________________________________________________________________
global_average_pooling2d_2 (Glo (None, 256)          0           add_2[0][0]                      
__________________________________________________________________________________________________
reshape_2 (Reshape)             (None, 1, 1, 256)    0           global_average_pooling2d_2[0][0] 
__________________________________________________________________________________________________
dense_4 (Dense)                 (None, 1, 1, 32)     8192        reshape_2[0][0]                  
__________________________________________________________________________________________________
dense_5 (Dense)                 (None, 1, 1, 256)    8192        dense_4[0][0]                    
__________________________________________________________________________________________________
multiply_2 (Multiply)           (None, 64, 1, 256)   0           add_2[0][0]                      
                                                                 dense_5[0][0]                    
__________________________________________________________________________________________________
conv2d_9 (Conv2D)               (None, 64, 1, 512)   1180160     multiply_2[0][0]                 
__________________________________________________________________________________________________
conv2d_10 (Conv2D)              (None, 64, 1, 512)   1180160     multiply_2[0][0]                 
__________________________________________________________________________________________________
conv2d_11 (Conv2D)              (None, 64, 1, 512)   1180160     multiply_2[0][0]                 
__________________________________________________________________________________________________
conv2d_12 (Conv2D)              (None, 64, 1, 512)   1180160     multiply_2[0][0]                 
__________________________________________________________________________________________________
batch_normalization_8 (BatchNor (None, 64, 1, 512)   2048        conv2d_9[0][0]                   
__________________________________________________________________________________________________
batch_normalization_9 (BatchNor (None, 64, 1, 512)   2048        conv2d_10[0][0]                  
__________________________________________________________________________________________________
batch_normalization_10 (BatchNo (None, 64, 1, 512)   2048        conv2d_11[0][0]                  
__________________________________________________________________________________________________
batch_normalization_11 (BatchNo (None, 64, 1, 512)   2048        conv2d_12[0][0]                  
__________________________________________________________________________________________________
add_3 (Add)                     (None, 64, 1, 512)   0           batch_normalization_8[0][0]      
                                                                 batch_normalization_9[0][0]      
                                                                 batch_normalization_10[0][0]     
                                                                 batch_normalization_11[0][0]     
__________________________________________________________________________________________________
batch_normalization_12 (BatchNo (None, 256, 1, 128)  512         multiply_1[0][0]                 
__________________________________________________________________________________________________
conv2d_13 (Conv2D)              (None, 64, 1, 512)   262656      add_3[0][0]                      
__________________________________________________________________________________________________
activation_5 (Activation)       (None, 256, 1, 128)  0           batch_normalization_12[0][0]     
__________________________________________________________________________________________________
batch_normalization_13 (BatchNo (None, 64, 1, 512)   2048        conv2d_13[0][0]                  
__________________________________________________________________________________________________
conv2d_14 (Conv2D)              (None, 256, 1, 512)  590336      activation_5[0][0]               
__________________________________________________________________________________________________
activation_6 (Activation)       (None, 64, 1, 512)   0           batch_normalization_13[0][0]     
__________________________________________________________________________________________________
max_pooling2d (MaxPooling2D)    (None, 64, 1, 512)   0           conv2d_14[0][0]                  
__________________________________________________________________________________________________
conv2d_15 (Conv2D)              (None, 64, 1, 512)   2359808     activation_6[0][0]               
__________________________________________________________________________________________________
add_4 (Add)                     (None, 64, 1, 512)   0           max_pooling2d[0][0]              
                                                                 conv2d_15[0][0]                  
__________________________________________________________________________________________________
batch_normalization_14 (BatchNo (None, 64, 1, 512)   2048        add_4[0][0]                      
__________________________________________________________________________________________________
activation_7 (Activation)       (None, 64, 1, 512)   0           batch_normalization_14[0][0]     
__________________________________________________________________________________________________
conv2d_16 (Conv2D)              (None, 64, 1, 512)   2359808     activation_7[0][0]               
__________________________________________________________________________________________________
multiply_3 (Multiply)           (None, 64, 1, 512)   0           conv2d_16[0][0]                  
                                                                 conv2d_13[0][0]                  
__________________________________________________________________________________________________
up_sampling2d (UpSampling2D)    (None, 256, 1, 512)  0           multiply_3[0][0]                 
__________________________________________________________________________________________________
concatenate (Concatenate)       (None, 256, 1, 640)  0           up_sampling2d[0][0]              
                                                                 multiply_1[0][0]                 
__________________________________________________________________________________________________
batch_normalization_15 (BatchNo (None, 256, 1, 640)  2560        concatenate[0][0]                
__________________________________________________________________________________________________
activation_8 (Activation)       (None, 256, 1, 640)  0           batch_normalization_15[0][0]     
__________________________________________________________________________________________________
conv2d_17 (Conv2D)              (None, 256, 1, 256)  491776      activation_8[0][0]               
__________________________________________________________________________________________________
batch_normalization_16 (BatchNo (None, 256, 1, 256)  1024        conv2d_17[0][0]                  
__________________________________________________________________________________________________
activation_9 (Activation)       (None, 256, 1, 256)  0           batch_normalization_16[0][0]     
__________________________________________________________________________________________________
conv2d_19 (Conv2D)              (None, 256, 1, 256)  164096      concatenate[0][0]                
__________________________________________________________________________________________________
conv2d_18 (Conv2D)              (None, 256, 1, 256)  196864      activation_9[0][0]               
__________________________________________________________________________________________________
batch_normalization_17 (BatchNo (None, 256, 1, 256)  1024        conv2d_19[0][0]                  
__________________________________________________________________________________________________
add_5 (Add)                     (None, 256, 1, 256)  0           conv2d_18[0][0]                  
                                                                 batch_normalization_17[0][0]     
__________________________________________________________________________________________________
global_average_pooling2d_3 (Glo (None, 256)          0           add_5[0][0]                      
__________________________________________________________________________________________________
reshape_3 (Reshape)             (None, 1, 1, 256)    0           global_average_pooling2d_3[0][0] 
__________________________________________________________________________________________________
dense_6 (Dense)                 (None, 1, 1, 32)     8192        reshape_3[0][0]                  
__________________________________________________________________________________________________
dense_7 (Dense)                 (None, 1, 1, 256)    8192        dense_6[0][0]                    
__________________________________________________________________________________________________
batch_normalization_18 (BatchNo (None, 1024, 1, 64)  256         multiply[0][0]                   
__________________________________________________________________________________________________
multiply_4 (Multiply)           (None, 256, 1, 256)  0           add_5[0][0]                      
                                                                 dense_7[0][0]                    
__________________________________________________________________________________________________
activation_10 (Activation)      (None, 1024, 1, 64)  0           batch_normalization_18[0][0]     
__________________________________________________________________________________________________
batch_normalization_19 (BatchNo (None, 256, 1, 256)  1024        multiply_4[0][0]                 
__________________________________________________________________________________________________
conv2d_20 (Conv2D)              (None, 1024, 1, 256) 147712      activation_10[0][0]              
__________________________________________________________________________________________________
activation_11 (Activation)      (None, 256, 1, 256)  0           batch_normalization_19[0][0]     
__________________________________________________________________________________________________
max_pooling2d_1 (MaxPooling2D)  (None, 256, 1, 256)  0           conv2d_20[0][0]                  
__________________________________________________________________________________________________
conv2d_21 (Conv2D)              (None, 256, 1, 256)  590080      activation_11[0][0]              
__________________________________________________________________________________________________
add_6 (Add)                     (None, 256, 1, 256)  0           max_pooling2d_1[0][0]            
                                                                 conv2d_21[0][0]                  
__________________________________________________________________________________________________
batch_normalization_20 (BatchNo (None, 256, 1, 256)  1024        add_6[0][0]                      
__________________________________________________________________________________________________
activation_12 (Activation)      (None, 256, 1, 256)  0           batch_normalization_20[0][0]     
__________________________________________________________________________________________________
conv2d_22 (Conv2D)              (None, 256, 1, 256)  590080      activation_12[0][0]              
__________________________________________________________________________________________________
multiply_5 (Multiply)           (None, 256, 1, 256)  0           conv2d_22[0][0]                  
                                                                 multiply_4[0][0]                 
__________________________________________________________________________________________________
up_sampling2d_1 (UpSampling2D)  (None, 1024, 1, 256) 0           multiply_5[0][0]                 
__________________________________________________________________________________________________
concatenate_1 (Concatenate)     (None, 1024, 1, 320) 0           up_sampling2d_1[0][0]            
                                                                 multiply[0][0]                   
__________________________________________________________________________________________________
batch_normalization_21 (BatchNo (None, 1024, 1, 320) 1280        concatenate_1[0][0]              
__________________________________________________________________________________________________
activation_13 (Activation)      (None, 1024, 1, 320) 0           batch_normalization_21[0][0]     
__________________________________________________________________________________________________
conv2d_23 (Conv2D)              (None, 1024, 1, 128) 123008      activation_13[0][0]              
__________________________________________________________________________________________________
batch_normalization_22 (BatchNo (None, 1024, 1, 128) 512         conv2d_23[0][0]                  
__________________________________________________________________________________________________
activation_14 (Activation)      (None, 1024, 1, 128) 0           batch_normalization_22[0][0]     
__________________________________________________________________________________________________
conv2d_25 (Conv2D)              (None, 1024, 1, 128) 41088       concatenate_1[0][0]              
__________________________________________________________________________________________________
conv2d_24 (Conv2D)              (None, 1024, 1, 128) 49280       activation_14[0][0]              
__________________________________________________________________________________________________
batch_normalization_23 (BatchNo (None, 1024, 1, 128) 512         conv2d_25[0][0]                  
__________________________________________________________________________________________________
add_7 (Add)                     (None, 1024, 1, 128) 0           conv2d_24[0][0]                  
                                                                 batch_normalization_23[0][0]     
__________________________________________________________________________________________________
global_average_pooling2d_4 (Glo (None, 128)          0           add_7[0][0]                      
__________________________________________________________________________________________________
reshape_4 (Reshape)             (None, 1, 1, 128)    0           global_average_pooling2d_4[0][0] 
__________________________________________________________________________________________________
dense_8 (Dense)                 (None, 1, 1, 16)     2048        reshape_4[0][0]                  
__________________________________________________________________________________________________
dense_9 (Dense)                 (None, 1, 1, 128)    2048        dense_8[0][0]                    
__________________________________________________________________________________________________
multiply_6 (Multiply)           (None, 1024, 1, 128) 0           add_7[0][0]                      
                                                                 dense_9[0][0]                    
__________________________________________________________________________________________________
conv2d_26 (Conv2D)              (None, 1024, 1, 64)  73792       multiply_6[0][0]                 
__________________________________________________________________________________________________
conv2d_27 (Conv2D)              (None, 1024, 1, 64)  73792       multiply_6[0][0]                 
__________________________________________________________________________________________________
conv2d_28 (Conv2D)              (None, 1024, 1, 64)  73792       multiply_6[0][0]                 
__________________________________________________________________________________________________
conv2d_29 (Conv2D)              (None, 1024, 1, 64)  73792       multiply_6[0][0]                 
__________________________________________________________________________________________________
batch_normalization_24 (BatchNo (None, 1024, 1, 64)  256         conv2d_26[0][0]                  
__________________________________________________________________________________________________
batch_normalization_25 (BatchNo (None, 1024, 1, 64)  256         conv2d_27[0][0]                  
__________________________________________________________________________________________________
batch_normalization_26 (BatchNo (None, 1024, 1, 64)  256         conv2d_28[0][0]                  
__________________________________________________________________________________________________
batch_normalization_27 (BatchNo (None, 1024, 1, 64)  256         conv2d_29[0][0]                  
__________________________________________________________________________________________________
add_8 (Add)                     (None, 1024, 1, 64)  0           batch_normalization_24[0][0]     
                                                                 batch_normalization_25[0][0]     
                                                                 batch_normalization_26[0][0]     
                                                                 batch_normalization_27[0][0]     
__________________________________________________________________________________________________
conv2d_30 (Conv2D)              (None, 1024, 1, 64)  4160        add_8[0][0]                      
__________________________________________________________________________________________________
conv2d_31 (Conv2D)              (None, 1024, 1, 1)   65          conv2d_30[0][0]                  
__________________________________________________________________________________________________
activation_15 (Activation)      (None, 1024, 1, 1)   0           conv2d_31[0][0]                  
==================================================================================================
Total params: 13,487,681
Trainable params: 13,473,985
Non-trainable params: 13,696
__________________________________________________________________________________________________
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_gen</span><span class="p">,</span>
          <span class="n">validation_data</span><span class="o">=</span><span class="n">valid_gen</span><span class="p">,</span>
          <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span>
          <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/500
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-25 11:12:47.813721: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:185] None of the MLIR Optimization Passes are enabled (registered 2)
2022-07-25 11:12:52.722997: I tensorflow/stream_executor/cuda/cuda_dnn.cc:369] Loaded cuDNN version 8200
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>158/158 [==============================] - 86s 480ms/step - loss: 0.5583 - recall: 0.5810 - precision: 0.3824 - dice_coef: 0.4397 - true_skill_score: 0.5581 - mean_io_u: 0.6044 - val_loss: 0.5460 - val_recall: 0.8930 - val_precision: 0.3561 - val_dice_coef: 0.4550 - val_true_skill_score: 0.7093 - val_mean_io_u: 0.5910

Epoch 00001: val_loss improved from inf to 0.54604, saving model to Results/resunetplusplus_split1
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-07-25 11:14:19.381434: W tensorflow/python/util/util.cc:348] Sets are not currently considered sequences, but this may change in the future, so consider avoiding using them.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:tensorflow:Assets written to: Results/resunetplusplus_split1/assets
Epoch 2/500
158/158 [==============================] - 80s 508ms/step - loss: 0.5065 - recall: 0.5581 - precision: 0.4798 - dice_coef: 0.4932 - true_skill_score: 0.6028 - mean_io_u: 0.6188 - val_loss: 0.4679 - val_recall: 0.5774 - val_precision: 0.6703 - val_dice_coef: 0.5309 - val_true_skill_score: 0.5620 - val_mean_io_u: 0.6783

Epoch 00002: val_loss improved from 0.54604 to 0.46786, saving model to Results/resunetplusplus_split1
INFO:tensorflow:Assets written to: Results/resunetplusplus_split1/assets
Epoch 3/500
 71/158 [============&gt;.................] - ETA: 47s - loss: 0.4848 - recall: 0.5427 - precision: 0.5558 - dice_coef: 0.5152 - true_skill_score: 0.6302 - mean_io_u: 0.6401
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ipykernel_2500815</span><span class="o">/</span><span class="mf">2039064558.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_gen</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>           <span class="n">validation_data</span><span class="o">=</span><span class="n">valid_gen</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>           <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>           <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">)</span>

<span class="nn">~/newtfvenv/lib/python3.8/site-packages/keras/engine/training.py</span> in <span class="ni">fit</span><span class="nt">(self, x, y, batch_size, epochs, verbose, callbacks, validation_split, validation_data, shuffle, class_weight, sample_weight, initial_epoch, steps_per_epoch, validation_steps, validation_batch_size, validation_freq, max_queue_size, workers, use_multiprocessing)</span>
<span class="g g-Whitespace">   </span><span class="mi">1182</span>                 <span class="n">_r</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1183</span>               <span class="n">callbacks</span><span class="o">.</span><span class="n">on_train_batch_begin</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1184</span>               <span class="n">tmp_logs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_function</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1185</span>               <span class="k">if</span> <span class="n">data_handler</span><span class="o">.</span><span class="n">should_sync</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1186</span>                 <span class="n">context</span><span class="o">.</span><span class="n">async_wait</span><span class="p">()</span>

<span class="nn">~/newtfvenv/lib/python3.8/site-packages/tensorflow/python/eager/def_function.py</span> in <span class="ni">__call__</span><span class="nt">(self, *args, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">883</span> 
<span class="g g-Whitespace">    </span><span class="mi">884</span>       <span class="k">with</span> <span class="n">OptionalXlaContext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_jit_compile</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">885</span>         <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">886</span> 
<span class="g g-Whitespace">    </span><span class="mi">887</span>       <span class="n">new_tracing_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experimental_get_tracing_count</span><span class="p">()</span>

<span class="nn">~/newtfvenv/lib/python3.8/site-packages/tensorflow/python/eager/def_function.py</span> in <span class="ni">_call</span><span class="nt">(self, *args, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">915</span>       <span class="c1"># In this case we have created variables on the first call, so we run the</span>
<span class="g g-Whitespace">    </span><span class="mi">916</span>       <span class="c1"># defunned version which is guaranteed to never create variables.</span>
<span class="ne">--&gt; </span><span class="mi">917</span>       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stateless_fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>  <span class="c1"># pylint: disable=not-callable</span>
<span class="g g-Whitespace">    </span><span class="mi">918</span>     <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stateful_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">919</span>       <span class="c1"># Release the lock early so that multiple threads can perform the call</span>

<span class="nn">~/newtfvenv/lib/python3.8/site-packages/tensorflow/python/eager/function.py</span> in <span class="ni">__call__</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">3037</span>       <span class="p">(</span><span class="n">graph_function</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3038</span>        <span class="n">filtered_flat_args</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_define_function</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">3039</span>     <span class="k">return</span> <span class="n">graph_function</span><span class="o">.</span><span class="n">_call_flat</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">3040</span>         <span class="n">filtered_flat_args</span><span class="p">,</span> <span class="n">captured_inputs</span><span class="o">=</span><span class="n">graph_function</span><span class="o">.</span><span class="n">captured_inputs</span><span class="p">)</span>  <span class="c1"># pylint: disable=protected-access</span>
<span class="g g-Whitespace">   </span><span class="mi">3041</span> 

<span class="nn">~/newtfvenv/lib/python3.8/site-packages/tensorflow/python/eager/function.py</span> in <span class="ni">_call_flat</span><span class="nt">(self, args, captured_inputs, cancellation_manager)</span>
<span class="g g-Whitespace">   </span><span class="mi">1961</span>         <span class="ow">and</span> <span class="n">executing_eagerly</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1962</span>       <span class="c1"># No tape is watching; skip to running the function.</span>
<span class="ne">-&gt; </span><span class="mi">1963</span>       <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_call_outputs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inference_function</span><span class="o">.</span><span class="n">call</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1964</span>           <span class="n">ctx</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">cancellation_manager</span><span class="o">=</span><span class="n">cancellation_manager</span><span class="p">))</span>
<span class="g g-Whitespace">   </span><span class="mi">1965</span>     <span class="n">forward_backward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_forward_and_backward_functions</span><span class="p">(</span>

<span class="nn">~/newtfvenv/lib/python3.8/site-packages/tensorflow/python/eager/function.py</span> in <span class="ni">call</span><span class="nt">(self, ctx, args, cancellation_manager)</span>
<span class="g g-Whitespace">    </span><span class="mi">589</span>       <span class="k">with</span> <span class="n">_InterpolateFunctionError</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">590</span>         <span class="k">if</span> <span class="n">cancellation_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">591</span>           <span class="n">outputs</span> <span class="o">=</span> <span class="n">execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">592</span>               <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signature</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">593</span>               <span class="n">num_outputs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_outputs</span><span class="p">,</span>

<span class="nn">~/newtfvenv/lib/python3.8/site-packages/tensorflow/python/eager/execute.py</span> in <span class="ni">quick_execute</span><span class="nt">(op_name, num_outputs, inputs, attrs, ctx, name)</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span>   <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span>     <span class="n">ctx</span><span class="o">.</span><span class="n">ensure_initialized</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">59</span>     <span class="n">tensors</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_Execute</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">_handle</span><span class="p">,</span> <span class="n">device_name</span><span class="p">,</span> <span class="n">op_name</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">60</span>                                         <span class="n">inputs</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">num_outputs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span>   <span class="k">except</span> <span class="n">core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">postProcess</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>

<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1</span>


<span class="c1">## Model</span>
<span class="k">with</span> <span class="n">CustomObjectScope</span><span class="p">({</span><span class="s1">&#39;dice_loss&#39;</span><span class="p">:</span> <span class="n">dice_loss</span><span class="p">,</span> <span class="s1">&#39;dice_coef&#39;</span><span class="p">:</span> <span class="n">dice_coef</span><span class="p">,</span> <span class="s1">&#39;true_skill_score&#39;</span><span class="p">:</span> <span class="n">true_skill_score</span><span class="p">}):</span> 
    <span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
    

<span class="n">test_gen</span> <span class="o">=</span> <span class="n">UnetGen</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">stride</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span><span class="n">expanddims</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_gen</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">postProcess</span><span class="o">.</span><span class="n">generate_result</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">Y_test</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nguyen</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;listOfICMEs.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">chinchilla</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">read_chinchilla</span><span class="p">()</span>
<span class="n">chi</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">read_chi</span><span class="p">()</span>
<span class="n">helcats</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">get_catevents</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pds</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">resultbin</span> <span class="o">=</span> <span class="n">postProcess</span><span class="o">.</span><span class="n">make_binary</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;pred&#39;</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">events</span> <span class="o">=</span> <span class="n">postProcess</span><span class="o">.</span><span class="n">makeEventList</span><span class="p">(</span><span class="n">resultbin</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ICMEs</span> <span class="o">=</span> <span class="n">postProcess</span><span class="o">.</span><span class="n">removeCreepy</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">test_clouds</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">nguyen</span> <span class="k">if</span> <span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">begin</span><span class="o">.</span><span class="n">year</span><span class="o">==</span> <span class="n">test</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">begin</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">test</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">begin</span><span class="o">.</span><span class="n">year</span><span class="o">==</span><span class="n">test</span><span class="p">[</span><span class="mi">2</span><span class="p">]))]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">performance</span> <span class="k">as</span> <span class="nn">prf</span>

<span class="n">TP</span><span class="p">,</span> <span class="n">FN</span><span class="p">,</span> <span class="n">FP</span><span class="p">,</span> <span class="n">detected</span> <span class="o">=</span> <span class="n">prf</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">ICMEs</span><span class="p">,</span> <span class="n">test_clouds</span><span class="p">,</span> <span class="n">thres</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Precision is:&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">TP</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TP</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">FP</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Recall is:&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">TP</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TP</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">FN</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;True Positives&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">TP</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;False Negatives&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">FN</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;False Positives&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">FP</span><span class="p">))</span>

<span class="n">delay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">TP</span><span class="p">))</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">detected</span><span class="p">)):</span>
        <span class="n">delay</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">TP</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">begin</span> <span class="o">-</span> <span class="n">detected</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">begin</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">TP</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean Delay&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">delay</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">startlag</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">endlag</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">detected</span><span class="p">)):</span>
    <span class="n">predstart</span> <span class="o">=</span> <span class="n">TP</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">begin</span>
    <span class="n">predend</span> <span class="o">=</span> <span class="n">TP</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">end</span>
    <span class="n">startlag</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">predstart</span><span class="o">-</span><span class="n">detected</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">begin</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">endlag</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">predend</span><span class="o">-</span><span class="n">detected</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">end</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;Results/startlag&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">split</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.p&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">startlag</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;Results/endlag&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">split</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.p&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">endlag</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">ConfusionMatrixDisplay</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">cm</span> <span class="kn">import</span> <span class="n">make_confusion_matrix</span>

<span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">],</span> <span class="n">resultbin</span><span class="p">)</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;True Neg&#39;</span><span class="p">,</span><span class="s1">&#39;False Pos&#39;</span><span class="p">,</span><span class="s1">&#39;False Neg&#39;</span><span class="p">,</span><span class="s1">&#39;True Pos&#39;</span><span class="p">]</span>
<span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Background&#39;</span><span class="p">,</span> <span class="s1">&#39;ICME&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s1">&#39;Results/cm&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">split</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span><span class="p">,</span><span class="n">cm</span><span class="p">)</span>
<span class="n">cmevent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">FP</span><span class="p">)],[</span><span class="nb">len</span><span class="p">(</span><span class="n">FN</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">TP</span><span class="p">)]])</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s1">&#39;Results/cmevent&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">split</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span><span class="p">,</span><span class="n">cmevent</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;True Neg&#39;</span><span class="p">,</span><span class="s1">&#39;False Pos&#39;</span><span class="p">,</span><span class="s1">&#39;False Neg&#39;</span><span class="p">,</span><span class="s1">&#39;True Pos&#39;</span><span class="p">]</span>
<span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Background&#39;</span><span class="p">,</span> <span class="s1">&#39;ICME&#39;</span><span class="p">]</span>
<span class="n">make_confusion_matrix</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> 
                      <span class="n">group_names</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                      <span class="n">categories</span><span class="o">=</span><span class="n">categories</span><span class="p">,</span> 
                      <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Part_2/Chapter_1_ICMEsDetection/FullDataset"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      Durch The Europlanet ML Team<br/>
    
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>